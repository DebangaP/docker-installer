CRON_TZ=Asia/Kolkata
SHELL=/bin/bash
PATH=/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

4 9 * * * root cd /app && python /app/kite/KiteWS.py &
16 9 * * * root cd /app && python /app/market/CalculateTPO.py &

# Refresh holdings every 5 minutes during market hours (9 AM to 3:30 PM, Monday to Friday)
*/5 9-16 * * 1-5 root cd /app && python /app/holdings/RefreshHoldings.py >> /app/logs/holdings_refresh.log 2>&1 &
0,5,10,15,20,25,30 15 * * 1-5 root cd /app && python /app/holdings/RefreshHoldings.py >> /app/logs/holdings_refresh.log 2>&1 &

# Fetch options data every 5 minutes during market hours (9 AM to 3:30 PM, Monday to Friday)
*/5 9-16 * * 1-5 root cd /app && python /app/kite/KiteFetchOptions.py >> /app/logs/options_fetch.log 2>&1 &
0,5,10,15,20,25,30 15 * * 1-5 root cd /app && python /app/kite/KiteFetchOptions.py >> /app/logs/options_fetch.log 2>&1 &

# Fetch options data at 10 AM and 3 PM on weekends (Saturday and Sunday)
# Note: 0=Sunday, 6=Saturday in cron syntax
0 10 * * 0,6 root cd /app && python /app/kite/KiteFetchOptions.py >> /app/logs/options_fetch.log 2>&1 &
0 15 * * 0,6 root cd /app && python /app/kite/KiteFetchOptions.py >> /app/logs/options_fetch.log 2>&1 &

# Update OHLC price data every 30 minutes during market hours
*/30 9-16 * * 1-5 root python /app/kite/InsertOHLC.py &

# Refresh swing trade recommendations every 30 minutes during market hours (same frequency as OHLC)
*/30 9-16 * * 1-5 root cd /app && python /app/stocks/RefreshSwingTrades.py >> /app/logs/swing_trades_refresh.log 2>&1 &

# Refresh MF NAV data daily (after market close)
0 18 * * 1-5 root cd /app && python /app/holdings/RefreshMFNAV.py >> /app/logs/mf_nav_refresh.log 2>&1 &

# Daily prediction job: Calculate sentiment and generate predictions
# Fundamentals are fetched monthly (only if data is >30 days old)
# Sentiment is calculated daily (changes daily)
# Runs daily at 6 PM (after market close) to prepare predictions for next day
0 18 * * 1-5 root cd /app && python /app/scheduled_jobs/PredictionScheduler.py >> /app/logs/prediction_job.log 2>&1 &

# Monthly fundamental data fetch: Fetch fundamentals for all holdings and Nifty50
# Runs on the 1st of every month at 7 PM (after market close)
0 19 1 * * root cd /app && python /app/scheduled_jobs/PredictionScheduler.py --force-fundamentals --no-sentiment >> /app/logs/fundamental_fetch.log 2>&1 &

# Monthly market cap update: Update market cap from Yahoo Finance for all holdings and Nifty50
# Runs on the 1st of every month at 8 PM (after screener.in fundamental fetch)
0 20 1 * * root cd /app && python -c "from fundamentals.FetchMCap import MarketCapFetcher; fetcher = MarketCapFetcher(); result = fetcher.update_mcap(fetch_holdings=True, fetch_nifty50=True, batch_size=10, delay_between_batches=1.0); print(f'Market cap update result: {result}')" >> /app/logs/mcap_update.log 2>&1 &

# Monthly Yahoo fundamentals fetch: Fetch actions, income statements, insider transactions from Yahoo Finance
# Runs on the 1st of every month at 8:30 PM (after market cap update)
30 20 1 * * root cd /app && python -c "from fundamentals.FetchFundamentals import YahooFundamentalsFetcher; fetcher = YahooFundamentalsFetcher(); result = fetcher.fetch_fundamentals_for_missing_stocks(fetch_holdings=True, fetch_nifty50=True, batch_size=5, delay_between_batches=3.45); print(f'Yahoo fundamentals fetch result: {result}')" >> /app/logs/yahoo_fundamentals_fetch.log 2>&1 &

# Daily irrational analysis: Analyze holdings for irrational gains/losses
# Runs daily at 4:00 PM IST (after market close) to analyze all holdings
0 16 * * 1-5 root cd /app && python /app/scheduled_jobs/IrrationalAnalysisScheduler.py >> /app/logs/irrational_analysis.log 2>&1 &